# Render Blueprint for BloomWatch Kenya
# Unified deployment configuration - Single Web App + API Backend

services:
  # Main Web Application (Streamlit - with Farmer Portal + Admin Dashboard)
  - type: web
    name: bloomwatch-app
    env: python
    region: oregon
    plan: free
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: streamlit run app/streamlit_app_enhanced.py --server.port=$PORT --server.address=0.0.0.0 --server.headless=true
    envVars:
      - key: MONGODB_URI
        sync: false
      - key: AFRICASTALKING_USERNAME
        sync: false
      - key: AFRICASTALKING_API_KEY
        sync: false
      - key: ADMIN_PASSWORD
        sync: false
      - key: SECRET_KEY
        generateValue: true
    healthCheckPath: /

  # USSD/SMS API Backend (Flask)
  - type: web
    name: bloomwatch-api
    env: python
    region: oregon
    plan: free
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: cd backend && gunicorn ussd_api:app --bind 0.0.0.0:$PORT --workers 2 --timeout 120
    envVars:
      - key: MONGODB_URI
        sync: false
      - key: AFRICASTALKING_USERNAME
        sync: false
      - key: AFRICASTALKING_API_KEY
        sync: false
      - key: FLASK_ENV
        value: production
    healthCheckPath: /health

  # MongoDB (if not using Atlas)
  # - type: pserv
  #   name: bloomwatch-mongodb
  #   env: docker
  #   plan: free
  #   dockerfilePath: ./Dockerfile.mongo
  #   disk:
  #     name: mongodb-data
  #     mountPath: /data/db
  #     sizeGB: 1

databases:
  # Note: Render free tier doesn't include MongoDB
  # Use MongoDB Atlas (free tier) instead
  # Add connection string to MONGODB_URI env var

